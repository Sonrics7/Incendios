<!--Header-->
<!doctype html>
<html lang="es">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Inicio de sesión</title>
    <link rel="icon" type="image/x-icon" href="img/go-up-16-211768.png">
    <!-- Bootstrap CSS -->
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    -->
   <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    -->
    <!--<script src="https://kit.fontawesome.com/a90a0dbf10.js" crossorigin="anonymous"></script>-->
    <link rel="stylesheet" href="css/all.min.css">    
    <link rel="stylesheet" href="css/estilos.css">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
        
</head>
<!--Fin del Header-->

<body style="background-image: url('img/fondo4.jpg'); background-repeat: no-repeat; background-size: cover;">
  <div class="container">
      <div class="row justify-content-center pt-5 mt-5 m-1">
        <div class="col-md-6 col-sm-8 col-xl-4 col-lg-5 formulario">
          <form style="border:0px solid white;padding:1rem;border-radius: 0.5rem;">
          <div class="form-group text-center pt-3">
            <h1 class="text-center">!Bienvenido!</h1>
          </div>
          <div class="form-group mx-sm-4 pt-3">
            <input type="text" class="form-control fas fa-user" id ="Usuario" placeholder=" Usuario" required>
          </div>
          <div class="form-group mx-sm-4 pt-3">
            <input type="password" class="form-control fas fa-eye" id="Contrasena" placeholder=" Contraseña"  required>
          </div>
          <div class="form-group text-center pt-1">
            <a href="#" id="OlvidarContrasena" style="color:white">Olvide mi contraseña</a>
          </div>
          <div class="form-group mx-sm-4 pt-2">
            <button type="button" class="btn btn-block ingresar" id="BotonLogin">Entrar</button>
          </div>
          <div class="form-group text-right">
            <!--<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#reC">Olvidé la contraseña.</button>
            --><!--Olvidar contraseña-->
          <div class="modal fade" id="reC" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLongTitle">Recordar contraseña</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                    <h5 class="text-center" style="color: black;">Ingresa tu correo electrónico para enviar tu usuario y contraseña.</h5>
                  <div class="form-group mx-sm-4 pt-3">
                    <input type="email"  class="form-control fas fa-envelope" id="correo" placeholder=" Correo electrónico">
                  </div>
                  <div class="form-group mx-sm-4 pt-2">
                    <button type="button" id="BotonEnviarUsuario" class="btn btn-success">Enviar</button>
                  </div>
                </div>
                <div class="modal-footer">
                  <!--<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>-->
                </div>
              </div>
            </div>
          </div>
    <!---->

          <div class="form-group text-center">
            <a href="#" id="RegistroNuevo" style="color:white">¿No tienes cuenta? <strong>Registrate aqui.</strong></a>
          </div>
        </form>
        </div>
      </div>
      
    </div>
    <div clas="container">
      <img src="img/BLogo.png" width="250" height="120" aling="center">
    </div>

    <!--Registro-->
    <div class="modal fade" id="reG" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Para usar esta plataforma <strong>registrate.</strong></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
              
                <div class="form-row">
                <div class="form-group col-sm-6">
                  <label for="">Nombre:</label>
                  <input type="text" class="form-control fas fa-user" id="nombreR" placeholder=" Nombre">
                </div>
                <div class="form-group col-sm-6">
                  <label for="">Apellidos:</label>
                  <input type="text" class="form-control fas fa-user" id="apellidosR" placeholder=" Apellidos">
                </div>
                <div class="form-group col-sm-6">
                  <label for="">Usuario:</label>
                  <input type="text" class="form-control fas fa-user-plus" id="usuarioR" placeholder=" Usuario">
                </div>
                <div class="form-group col-sm-6">
                  <label for="">Contraseña:</label>
                  <input type="text" class="form-control fas fa-key" id="contrasenaR" placeholder=" Contraseña">
                </div>
                <div class="form-group col-sm-6">
                  <label for="">Cargo/Puesto:</label>
                <select class="form-control" id="cargoR">
                  <option>Administrador</option>
                  <option>Usuario</option>
                </select>
              </div>
                <div class="form-group col-sm-6">
                  <label for="">Correo electrónico:</label>
                  <input type="text" class="form-control fas fa-envelope" id="correoR" placeholder=" Correo electrónico">
                </div>
                <div class="form-group col-sm-6">
                  <label for="">Telefono - WhatsApp:</label>
                  <input type="text" class="form-control fab fa-whatsapp-square" id="telefonoR" placeholder=" Teléfono - WhatsApp">
                </div>
                <div class="form-group col-sm-6">
                  <label for="">Agrega tu fotografía:</label>
                  <input type="file" class="form-control" id="" placeholder="">
                </div>
                
                <div class="form-group col-sm-6">
                  <button type="button" id="EnviarRegistroNuevo" class="btn btn-success">Enviar registro.</button>
                </div>
              </div>
              
          </div>
          <div class="modal-footer">
            <!--<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>-->
              <h5>Te enviaremos un correo confirmando la activación de tu cuenta.</h5>
          </div>
        </div>
      </div>
    </div>
    <!---->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      //--------------------------------------------------------Login usuario
      $('#BotonLogin').click(function () {
        let usuario = retornarUsuario();
        loginUsuario(usuario);
      });

      
      function retornarUsuario() {
        let usuario = {
          usuario: $('#Usuario').val(),
          contrasena: $('#Contrasena').val()
        };
        return usuario;
      }

      function loginUsuario(usuario) {
        $.ajax({
          type: 'POST',
          url: 'login.php',
          data: usuario,
          success: function (respuesta) {
            if (respuesta == 'correcta') {
              window.location = 'menu.html';
            }
            else
              alert('Nombre de usuario o contraseña incorrecta');
          },
          error: function () {
            alert('Error');
          }
        });
      }
      //Recuperar contraseña------------------------------------------------------------
      $('#OlvidarContrasena').click(function () {
        borrarFormulario();
        $("#reC").modal();
      });

      $('#BotonEnviarUsuario').click(function () {
        let correoUser = retornarCorreo();
        if (validarCorreo(correoUser))
          mandarCorreo(correoUser);
      });

      function borrarFormulario() {
        $('#correo').val("");
         }

      function retornarCorreo() {
        let correoUser = {
          correo: $('#correo').val()
        };
        return correoUser;
      }

      function validarCorreo(correoUser) {
        if (correoUser.correo == '' ) {
          alert('No puede ingresar un correo vacío');

          return false;
        }
        return true;
      }

        function mandarCorreo(correoUser) {
        $.ajax({
          type: 'POST',
          url: 'datosUsuario.php?accion=enviar',
          data: correoUser,
          success: function (info) {
                  alert('Se te mandará nota para recuperar tu contraseña.');
                  $("#reC").modal('hide');
                },
          error: function () {
            alert('Error');
          }
        });
      }

      //Registro nuevo usuario------------------------------------------------------------
      $('#RegistroNuevo').click(function () {
        borrarFormularioR();
        $("#reG").modal();
      });

      $('#EnviarRegistroNuevo').click(function () {
        let usuarioNuevo = retornarUsuarioNuevo();
        if (validarUsuario(usuarioNuevo))
          registroUsuario(usuarioNuevo);
      });

      function borrarFormularioR() {
        $('#nombreR').val("");
        $('#apellidosR').val("");
        $('#usuarioR').val("");
        $('#contrasenaR').val("");
        $('#cargoR').val("");
        $('#correoR').val("");
        $('#telefonoR').val("");
         }

      function retornarUsuarioNuevo() {
        let usuarioNuevo = {
          nombreR: $('#nombreR').val(),
          apellidosR: $('#apellidosR').val(),
          usuarioR: $('#usuarioR').val(),
          contrasenaR: $('#contrasenaR').val(),
          cargoR: $('#cargoR').val(),
          correoR: $('#correoR').val(),
          telefonoR: $('#telefonoR').val()
        };
        return usuarioNuevo;
      }

      function validarUsuario(usuarioNuevo) {
        if (usuarioNuevo.nombreR == '') {
          alert('No puede ingresar un valor de nombre vacío');
          return false;
        }
        if (usuarioNuevo.apellidosR == '') {
          alert('No puede ingresar un valor de apellidos vacío');
          return false;
        }
        if (usuarioNuevo.usuarioR == '') {
          alert('No puede ingresar un valor de usuario vacío');
          return false;
        }
        if (usuarioNuevo.contrasenaR == '') {
          alert('No puede ingresar un valor de contraseña vacío');
          return false;
        }
        if (usuarioNuevo.cargoR == '') {
          alert('No puede ingresar un valor de cargo vacío');
          return false;
        }
        if (usuarioNuevo.correoR == '') {
          alert('No puede ingresar un valor de correo vacío');
          return false;
        }
        if (usuarioNuevo.telefonoR == '') {
          alert('No puede ingresar un valor de telefono vacío');
          return false;
        }
        return true;
      }

        function registroUsuario(usuarioNuevo) {
        $.ajax({
          type: 'POST',
          url: 'datosUsuario.php?accion=agregar',
          data: usuarioNuevo,
          success: function (info) {
                  alert('Se agrego el registro exitosamente.');
                  $("#reG").modal('hide');
                },
          error: function () {
            alert('Error');
          }
        });
      }

    });
 </script>
 </body>
    <!--Fin del footer-->
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!--<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>-->
</html>